FROM ruby:3.3.0

# node (esbuild / tailwind ç”¨)
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
  && apt-get update -y \
  && apt-get install -y nodejs postgresql-client \
  && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# bundler
RUN gem update --system && gem install bundler

# gems
COPY Gemfile Gemfile.lock ./
RUN bundle install

# node deps
COPY package.json package-lock.json ./
RUN npm ci

# app
COPY . .

EXPOSE 3000
CMD ["bash", "-lc", "bin/setup && bin/rails s -b 0.0.0.0 -p 3000"]
